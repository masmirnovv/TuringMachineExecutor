
// Calculates factorial of a given integer number

start: st
accept: done
reject: invalidInput
blank: _

// Stage 0: validate the input

st 0 -> 0validate 0 >
st 1 -> 0validate 1 >
st 2 -> 0validate 2 >
st 3 -> 0validate 3 >
st 4 -> 0validate 4 >
st 5 -> 0validate 5 >
st 6 -> 0validate 6 >
st 7 -> 0validate 7 >
st 8 -> 0validate 8 >
st 9 -> 0validate 9 >
0validate 0 -> 0validate 0 >
0validate 1 -> 0validate 1 >
0validate 2 -> 0validate 2 >
0validate 3 -> 0validate 3 >
0validate 4 -> 0validate 4 >
0validate 5 -> 0validate 5 >
0validate 6 -> 0validate 6 >
0validate 7 -> 0validate 7 >
0validate 8 -> 0validate 8 >
0validate 9 -> 0validate 9 >
0validate _ -> 0valid _ <
0valid 0 -> 0valid 0 <
0valid 1 -> 0valid 1 <
0valid 2 -> 0valid 2 <
0valid 3 -> 0valid 3 <
0valid 4 -> 0valid 4 <
0valid 5 -> 0valid 5 <
0valid 6 -> 0valid 6 <
0valid 7 -> 0valid 7 <
0valid 8 -> 0valid 8 <
0valid 9 -> 0valid 9 <
0valid _ -> 1st # <

// Stage 1: convert to binary

1st _ -> 1checkForMoreDigits O >
1checkForMoreDigits O -> 1checkForMoreDigits O >
1checkForMoreDigits I -> 1checkForMoreDigits I >
1checkForMoreDigits # -> 1checkForMoreDigits # >
1checkForMoreDigits _ -> 1clear _ <
1checkForMoreDigits 0 -> 1mul8 0 <
1checkForMoreDigits 1 -> 1mul8 1 <
1checkForMoreDigits 2 -> 1mul8 2 <
1checkForMoreDigits 3 -> 1mul8 3 <
1checkForMoreDigits 4 -> 1mul8 4 <
1checkForMoreDigits 5 -> 1mul8 5 <
1checkForMoreDigits 6 -> 1mul8 6 <
1checkForMoreDigits 7 -> 1mul8 7 <
1checkForMoreDigits 8 -> 1mul8 8 <
1checkForMoreDigits 9 -> 1mul8 9 <
1mul8 # -> 1mul8 # <
1mul8 O -> 1mul8:O O <
1mul8 I -> 1mul8:I O <
1mul8:O O -> 1mul8:OO O <
1mul8:O _ -> 1mul8:OO O <
1mul8:O I -> 1mul8:OI O <
1mul8:I O -> 1mul8:IO O <
1mul8:I _ -> 1mul8:IO O <
1mul8:I I -> 1mul8:II O <
1mul8:OO O -> 1mul8:OOO O <
1mul8:OO _ -> 1mul8:OOO O <
1mul8:OO I -> 1mul8:OOI O <
1mul8:OI O -> 1mul8:OIO O <
1mul8:OI _ -> 1mul8:OIO O <
1mul8:OI I -> 1mul8:OII O <
1mul8:IO O -> 1mul8:IOO O <
1mul8:IO _ -> 1mul8:IOO O <
1mul8:IO I -> 1mul8:IOI O <
1mul8:II O -> 1mul8:IIO O <
1mul8:II _ -> 1mul8:IIO O <
1mul8:II I -> 1mul8:III O <
1mul8:OOO O -> 1mul8:OOO O <
1mul8:OOO _ -> 1goRight _ >
1mul8:OOO I -> 1mul8:OOI O <
1mul8:OOI O -> 1mul8:OIO O <
1mul8:OOI _ -> 1mul8:OIO O <
1mul8:OOI I -> 1mul8:OII O <
1mul8:OIO O -> 1mul8:IOO O <
1mul8:OIO _ -> 1mul8:IOO O <
1mul8:OIO I -> 1mul8:IOI O <
1mul8:OII O -> 1mul8:IIO O <
1mul8:OII _ -> 1mul8:IIO O <
1mul8:OII I -> 1mul8:III O <
1mul8:IOO O -> 1mul8:OOO I <
1mul8:IOO _ -> 1mul8:OOO I <
1mul8:IOO I -> 1mul8:OOI I <
1mul8:IOI O -> 1mul8:OIO I <
1mul8:IOI _ -> 1mul8:OIO I <
1mul8:IOI I -> 1mul8:OII I <
1mul8:IIO O -> 1mul8:IOO I <
1mul8:IIO _ -> 1mul8:IOO I <
1mul8:IIO I -> 1mul8:IOI I <
1mul8:III O -> 1mul8:IIO I <
1mul8:III _ -> 1mul8:IIO I <
1mul8:III I -> 1mul8:III I <
1goRight O -> 1goRight O >
1goRight I -> 1goRight I >
1goRight # -> 1newDigit # <
1newDigit O -> 1grabNewDigit2 O <
1newDigit I -> 1grabNewDigit2 I <
1newDigit _ -> 1addDigit _ >
1grabNewDigit2 O -> 1grabNewDigit1 O <
1grabNewDigit2 I -> 1grabNewDigit1 I <
1grabNewDigit2 _ -> 1carryNewDigit2:O _ >
1grabNewDigit1 O -> 1carryNewDigit1:O O >
1grabNewDigit1 I -> 1carryNewDigit1:I I >
1grabNewDigit1 _ -> 1carryNewDigit1:O _ >
1carryNewDigit1:O O -> 1carryNewDigit2:O O >
1carryNewDigit1:O I -> 1carryNewDigit2:O I >
1carryNewDigit1:I O -> 1carryNewDigit2:I O >
1carryNewDigit1:I I -> 1carryNewDigit2:I I >
1carryNewDigit2:O O -> 1newDigit O <
1carryNewDigit2:O I -> 1newDigit I <
1carryNewDigit2:I O -> 1newDigit I <
1carryNewDigit2:I I -> 1newDigit W <
1addDigit O -> 1addDigit O >
1addDigit I -> 1addDigit I >
1addDigit W -> 1addDigit W >
1addDigit # -> 1addDigit # >
1addDigit 0 -> 1addDigit:0 # <
1addDigit 1 -> 1addDigit:1 # <
1addDigit 2 -> 1addDigit:2 # <
1addDigit 3 -> 1addDigit:3 # <
1addDigit 4 -> 1addDigit:4 # <
1addDigit 5 -> 1addDigit:5 # <
1addDigit 6 -> 1addDigit:6 # <
1addDigit 7 -> 1addDigit:7 # <
1addDigit 8 -> 1addDigit:8 # <
1addDigit 9 -> 1addDigit:9 # <
1addDigit:0 # -> 1addDigit:0 # <
1addDigit:1 # -> 1addDigit:1 # <
1addDigit:2 # -> 1addDigit:2 # <
1addDigit:3 # -> 1addDigit:3 # <
1addDigit:4 # -> 1addDigit:4 # <
1addDigit:5 # -> 1addDigit:5 # <
1addDigit:6 # -> 1addDigit:6 # <
1addDigit:7 # -> 1addDigit:7 # <
1addDigit:8 # -> 1addDigit:8 # <
1addDigit:9 # -> 1addDigit:9 # <
1addDigit:0 O -> 1addDigit:0 O <
1addDigit:0 I -> 1addDigit:0 I <
1addDigit:0 W -> 1addDigit:1 O <
1addDigit:0 _ -> 1checkForMoreDigits _ >
1addDigit:1 O -> 1addDigit:0 I <
1addDigit:1 I -> 1addDigit:1 O <
1addDigit:1 W -> 1addDigit:1 I <
1addDigit:1 _ -> 1checkForMoreDigits I >
1addDigit:2 O -> 1addDigit:1 O <
1addDigit:2 _ -> 1addDigit:1 O <
1addDigit:2 I -> 1addDigit:1 I <
1addDigit:2 W -> 1addDigit:2 O <
1addDigit:3 O -> 1addDigit:1 I <
1addDigit:3 _ -> 1addDigit:1 I <
1addDigit:3 I -> 1addDigit:2 O <
1addDigit:3 W -> 1addDigit:2 I <
1addDigit:4 O -> 1addDigit:2 O <
1addDigit:4 _ -> 1addDigit:2 O <
1addDigit:4 I -> 1addDigit:2 I <
1addDigit:4 W -> 1addDigit:3 O <
1addDigit:5 O -> 1addDigit:2 I <
1addDigit:5 _ -> 1addDigit:2 I <
1addDigit:5 I -> 1addDigit:3 O <
1addDigit:5 W -> 1addDigit:3 I <
1addDigit:6 O -> 1addDigit:3 O <
1addDigit:6 _ -> 1addDigit:3 O <
1addDigit:6 I -> 1addDigit:3 I <
1addDigit:6 W -> 1addDigit:4 O <
1addDigit:7 O -> 1addDigit:3 I <
1addDigit:7 _ -> 1addDigit:3 I <
1addDigit:7 I -> 1addDigit:4 O <
1addDigit:7 W -> 1addDigit:4 I <
1addDigit:8 O -> 1addDigit:4 O <
1addDigit:8 _ -> 1addDigit:4 O <
1addDigit:8 I -> 1addDigit:4 I <
1addDigit:8 W -> 1addDigit:5 O <
1addDigit:9 O -> 1addDigit:4 I <
1addDigit:9 _ -> 1addDigit:4 I <
1addDigit:9 I -> 1addDigit:5 O <
1addDigit:9 W -> 1addDigit:5 I <
1clear # -> 1clear _ <
1clear O -> 1clear 0 <
1clear I -> 1clear 1 <
1clear _ -> 2st _ >

// Stage 2: calculate factorial in binary

2st 0 -> 2st 0 >
2st 1 -> 2st1 1 <
2st _ -> 2return1 _ <
2return1 0 -> 2return1 _ <
2return1 _ -> 3st 1 ^
2st1 0 -> 2st1 0 <
2st1 1 -> 2st1 1 <
2st1 _ -> 2st2 * <
2st2 _ -> 2st3 1 <
2st3 _ -> 2st4 = <
2st4 _ -> 2checkformoredigits1 0 >
2checkformoredigits1 0 -> 2checkformoredigits1 0 >
2checkformoredigits1 1 -> 2checkformoredigits1 1 >
2checkformoredigits1 = -> 2checkformoredigits1 = >
2checkformoredigits1 * -> 2checkformoredigits2 * >
2checkformoredigits2 * -> 2checkformoredigits2 * >
2checkformoredigits2 O -> 2checkformoredigits2 O >
2checkformoredigits2 I -> 2checkformoredigits2 I >
2checkformoredigits2 0 -> 2mult1 0 <
2checkformoredigits2 1 -> 2mult1 1 <
2checkformoredigits2 _ -> 2clearMultC _ <
2mult1 0 -> 2mult1 0 <
2mult1 1 -> 2mult1 1 <
2mult1 O -> 2mult1 O <
2mult1 I -> 2mult1 I <
2mult1 * -> 2mult1 * <
2mult1 = -> 2multShift0 = <
2multShift0 0 -> 2multShift0 0 <
2multShift0 1 -> 2multShift1 0 <
2multShift0 _ -> 2getDigit0 _ >
2multShift1 0 -> 2multShift0 1 <
2multShift1 1 -> 2multShift1 1 <
2multShift1 _ -> 2getDigit0 1 >
2getDigit0 0 -> 2getDigit0 0 >
2getDigit0 1 -> 2getDigit0 1 >
2getDigit0 = -> 2getDigit0 = >
2getDigit0 * -> 2getDigit1 * >
2getDigit1 * -> 2getDigit1 * >
2getDigit1 O -> 2getDigit1 O >
2getDigit1 I -> 2getDigit1 I >
2getDigit1 0 -> 2checkformoredigits2 O >
2getDigit1 1 -> 2prepareForSum I <
2prepareForSum * -> 2prepareForSum * <
2prepareForSum O -> 2prepareForSum O <
2prepareForSum I -> 2prepareForSum I <
2prepareForSum 0 -> 2carryo1 o <
2prepareForSum 1 -> 2carryi1 i <
2carryo1 0 -> 2carryo1 0 <
2carryo1 1 -> 2carryo1 1 <
2carryo1 = -> 2carryo = <
2carryi1 0 -> 2carryi1 0 <
2carryi1 1 -> 2carryi1 1 <
2carryi1 = -> 2carryi = <
2carryo o -> 2carryo o <
2carryo i -> 2carryo i <
2carryo k -> 2carryo k <
2carryo 0 -> 2catch o >
2carryo 1 -> 2catch i >
2carryo _ -> 2catch o >
2carryi o -> 2carryi o <
2carryi i -> 2carryi i <
2carryi k -> 2carryi k <
2carryi 0 -> 2catch i >
2carryi 1 -> 2catch k >
2carryi _ -> 2catch i >
2catch o -> 2catch o >
2catch i -> 2catch i >
2catch k -> 2catch k >
2catch = -> 2catch1 = >
2catch1 0 -> 2catch1 0 >
2catch1 1 -> 2catch1 1 >
2catch1 o -> 2carryThis o <
2catch1 i -> 2carryThis i <
2carryThis 0 -> 2carryo1 o <
2carryThis 1 -> 2carryi1 i <
2carryThis = -> 2shiftSumCarry0 = <
2shiftSumCarry0 o -> 2shiftSumCarry0 o <
2shiftSumCarry0 0 -> 2shiftSumCarry0 o <
2shiftSumCarry0 i -> 2shiftSumCarry0 i <
2shiftSumCarry0 1 -> 2shiftSumCarry0 i <
2shiftSumCarry0 k -> 2shiftSumCarry1 o <
2shiftSumCarry0 _ -> 2restore _ >
2shiftSumCarry1 o -> 2shiftSumCarry0 i <
2shiftSumCarry1 0 -> 2shiftSumCarry0 i <
2shiftSumCarry1 i -> 2shiftSumCarry1 o <
2shiftSumCarry1 1 -> 2shiftSumCarry1 o <
2shiftSumCarry1 k -> 2shiftSumCarry1 i <
2shiftSumCarry1 _ -> 2restore 1 >
2restore i -> 2restore 1 >
2restore o -> 2restore 0 >
2restore = -> 2restore = >
2restore * -> 2checkformoredigits1 * ^
2clearMultC O -> 2clearMultC O <
2clearMultC I -> 2clearMultC I <
2clearMultC * -> 2clearMultB * <
2clearMultB * -> 2clearMultB * <
2clearMultB 0 -> 2clearMultB * <
2clearMultB 1 -> 2clearMultB * <
2clearMultB = -> 2saveLastStar * >
2saveLastStar * -> 2saveLastStar * >
2saveLastStar I -> 2saveThisStar I <
2saveLastStar O -> 2saveThisStar O <
2saveThisStar * -> 2catchNumToShift # <
2catchNumToShift * -> 2catchNumToShift * <
2catchNumToShift 0 -> 2carryNumToShift0 * >
2catchNumToShift 1 -> 2carryNumToShift1 * >
2catchNumToShift _ -> 2reformatAfterMultA _ >
2carryNumToShift0 * -> 2carryNumToShift0 * >
2carryNumToShift0 0 -> 2setThereNum0 0 <
2carryNumToShift0 1 -> 2setThereNum0 1 <
2carryNumToShift0 # -> 2setThereNum0 # <
2carryNumToShift1 * -> 2carryNumToShift1 * >
2carryNumToShift1 0 -> 2setThereNum1 0 <
2carryNumToShift1 1 -> 2setThereNum1 1 <
2carryNumToShift1 # -> 2setThereNum1 # <
2setThereNum0 * -> 2catchNumToShift 0 <
2setThereNum1 * -> 2catchNumToShift 1 <
2reformatAfterMultA * -> 2reformatAfterMultA _ >
2reformatAfterMultA 0 -> 2reformatAfterMultB 0 >
2reformatAfterMultA 1 -> 2reformatAfterMultB 1 >
2reformatAfterMultB 0 -> 2reformatAfterMultB 0 >
2reformatAfterMultB 1 -> 2reformatAfterMultB 1 >
2reformatAfterMultB # -> 2reformatAfterMultB * >
2reformatAfterMultB O -> 2reformatAfterMultB O >
2reformatAfterMultB I -> 2reformatAfterMultB I >
2reformatAfterMultB _ -> 2subtract1probBe0 _ <
2subtract1probBe0 O -> 2subtract1 1 <
2subtract1probBe0 I -> 2reformat2ndProbBe0 0 <
2subtract1 O -> 2subtract1 1 <
2subtract1 I -> 2reformat2nd 0 <
2reformat2ndProbBe0 O -> 2reformat2ndProbBe0 0 <
2reformat2ndProbBe0 I -> 2reformat2nd 1 <
2reformat2ndProbBe0 * -> 2clearRestA * >
2reformat2nd O -> 2reformat2nd 0 <
2reformat2nd I -> 2reformat2nd 1 <
2reformat2nd * -> 2moveToStart * <
2moveToStart 0 -> 2moveToStart 0 <
2moveToStart 1 -> 2moveToStart 1 <
2moveToStart _ -> 2st4 = <
2clearRestA 0 -> 2clearRestA 0 >
2clearRestA _ -> 2clearRestB _ <
2clearRestB 0 -> 2clearRestB _ <
2clearRestB * -> 2clearRestC _ <
2clearRestC 0 -> 2clearRestC 0 <
2clearRestC 1 -> 2clearRestC 1 <
2clearRestC _ -> 3st _ >

// Stage 3: convert back from binary

3st 0 -> 3st O >
3st 1 -> 3st I >
3st _ -> 3add# _ <
3add# O -> 3add# O <
3add# I -> 3add# I <
3add# _ -> 3add0 # <
3add0 _ -> 3checkForMoreDigits 0 >
3checkForMoreDigits 0 -> 3checkForMoreDigits 0 >
3checkForMoreDigits 1 -> 3checkForMoreDigits 1 >
3checkForMoreDigits 2 -> 3checkForMoreDigits 2 >
3checkForMoreDigits 3 -> 3checkForMoreDigits 3 >
3checkForMoreDigits 4 -> 3checkForMoreDigits 4 >
3checkForMoreDigits 5 -> 3checkForMoreDigits 5 >
3checkForMoreDigits 6 -> 3checkForMoreDigits 6 >
3checkForMoreDigits 7 -> 3checkForMoreDigits 7 >
3checkForMoreDigits 8 -> 3checkForMoreDigits 8 >
3checkForMoreDigits 9 -> 3checkForMoreDigits 9 >
3checkForMoreDigits # -> 3checkForMoreDigits # >
3checkForMoreDigits O -> 3mul2add0 # <
3checkForMoreDigits I -> 3mul2add1 # <
3checkForMoreDigits _ -> 3clear _ <
3mul2add0 # -> 3mul2add0 # <
3mul2add0 0 -> 3mul2add0 0 <
3mul2add0 1 -> 3mul2add0 2 <
3mul2add0 2 -> 3mul2add0 4 <
3mul2add0 3 -> 3mul2add0 6 <
3mul2add0 4 -> 3mul2add0 8 <
3mul2add0 5 -> 3mul2add1 0 <
3mul2add0 6 -> 3mul2add1 2 <
3mul2add0 7 -> 3mul2add1 4 <
3mul2add0 8 -> 3mul2add1 6 <
3mul2add0 9 -> 3mul2add1 8 <
3mul2add0 _ -> 3checkForMoreDigits _ >
3mul2add1 # -> 3mul2add1 # <
3mul2add1 0 -> 3mul2add0 1 <
3mul2add1 1 -> 3mul2add0 3 <
3mul2add1 2 -> 3mul2add0 5 <
3mul2add1 3 -> 3mul2add0 7 <
3mul2add1 4 -> 3mul2add0 9 <
3mul2add1 5 -> 3mul2add1 1 <
3mul2add1 6 -> 3mul2add1 3 <
3mul2add1 7 -> 3mul2add1 5 <
3mul2add1 8 -> 3mul2add1 7 <
3mul2add1 9 -> 3mul2add1 9 <
3mul2add1 _ -> 3checkForMoreDigits 1 >
3clear # -> 3clear _ <
3clear 0 -> 3clear 0 <
3clear 1 -> 3clear 1 <
3clear 2 -> 3clear 2 <
3clear 3 -> 3clear 3 <
3clear 4 -> 3clear 4 <
3clear 5 -> 3clear 5 <
3clear 6 -> 3clear 6 <
3clear 7 -> 3clear 7 <
3clear 8 -> 3clear 8 <
3clear 9 -> 3clear 9 <
3clear _ -> done _ >